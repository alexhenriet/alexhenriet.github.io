<h1 id="gulp-postcss">gulp-postcss</h1>

<p><img src="https://github.com/postcss/gulp-postcss/actions/workflows/test.yml/badge.svg?branch=main" alt="Build Status" />
<a href="https://coveralls.io/r/postcss/gulp-postcss"><img src="https://img.shields.io/coveralls/postcss/gulp-postcss.svg" alt="Coverage Status" /></a></p>

<p><a href="https://github.com/postcss/postcss">PostCSS</a> gulp plugin to pipe CSS through
several plugins, but parse CSS only once.</p>

<h2 id="install">Install</h2>

<pre><code>$ npm install --save-dev postcss gulp-postcss
</code></pre>

<p>Install required <a href="https://www.npmjs.com/browse/keyword/postcss-plugin">postcss plugins</a> separately. E.g. for autoprefixer, you need to install <a href="https://github.com/postcss/autoprefixer">autoprefixer</a> package.</p>

<h2 id="basic-usage">Basic usage</h2>

<p>The configuration is loaded automatically from <code>postcss.config.js</code>
as <a href="https://www.npmjs.com/package/postcss-load-config">described here</a>,
so you don't have to specify any options.</p>

<pre><code class="js">var postcss = require('gulp-postcss');
var gulp = require('gulp');

gulp.task('css', function () {
    return gulp.src('./src/*.css')
        .pipe(postcss())
        .pipe(gulp.dest('./dest'));
});
</code></pre>

<h2 id="passing-plugins-directly">Passing plugins directly</h2>

<pre><code class="js">var postcss = require('gulp-postcss');
var gulp = require('gulp');
var autoprefixer = require('autoprefixer');
var cssnano = require('cssnano');

gulp.task('css', function () {
    var plugins = [
        autoprefixer({browsers: ['last 1 version']}),
        cssnano()
    ];
    return gulp.src('./src/*.css')
        .pipe(postcss(plugins))
        .pipe(gulp.dest('./dest'));
});
</code></pre>

<h2 id="using-with-.pcss-extension">Using with .pcss extension</h2>

<p>For using gulp-postcss to have input files in .pcss format and get .css output need additional library like gulp-rename.</p>

<pre><code class="js">var postcss = require('gulp-postcss');
var gulp = require('gulp');
const rename = require('gulp-rename');

gulp.task('css', function () {
    return gulp.src('./src/*.pcss')
        .pipe(postcss())
        .pipe(rename({
          extname: '.css'
        }))
        .pipe(gulp.dest('./dest'));
});
</code></pre>

<p>This is done for more explicit transformation. According to <a href="https://github.com/gulpjs/gulp/blob/master/docs/writing-a-plugin/guidelines.md#guidelines">gulp plugin guidelines</a></p>

<blockquote>
  <p>Your plugin should only do one thing, and do it well.</p>
</blockquote>

<h2 id="passing-additional-options-to-postcss">Passing additional options to PostCSS</h2>

<p>The second optional argument to gulp-postcss is passed to PostCSS.</p>

<p>This, for instance, may be used to enable custom parser:</p>

<pre><code class="js">var gulp = require('gulp');
var postcss = require('gulp-postcss');
var nested = require('postcss-nested');
var sugarss = require('sugarss');

gulp.task('default', function () {
    var plugins = [nested];
    return gulp.src('in.sss')
        .pipe(postcss(plugins, { parser: sugarss }))
        .pipe(gulp.dest('out'));
});
</code></pre>

<h2 id="using-a-custom-processor">Using a custom processor</h2>

<pre><code class="js">var postcss = require('gulp-postcss');
var cssnext = require('postcss-cssnext');
var opacity = function (css, opts) {
    css.walkDecls(function(decl) {
        if (decl.prop === 'opacity') {
            decl.parent.insertAfter(decl, {
                prop: '-ms-filter',
                value: '"progid:DXImageTransform.Microsoft.Alpha(Opacity=' + (parseFloat(decl.value) * 100) + ')"'
            });
        }
    });
};

gulp.task('css', function () {
    var plugins = [
        cssnext({browsers: ['last 1 version']}),
        opacity
    ];
    return gulp.src('./src/*.css')
        .pipe(postcss(plugins))
        .pipe(gulp.dest('./dest'));
});
</code></pre>

<h2 id="source-map-support">Source map support</h2>

<p>Source map is disabled by default, to extract map use together
with <a href="https://github.com/floridoo/gulp-sourcemaps">gulp-sourcemaps</a>.</p>

<pre><code class="js">return gulp.src('./src/*.css')
    .pipe(sourcemaps.init())
    .pipe(postcss(plugins))
    .pipe(sourcemaps.write('.'))
    .pipe(gulp.dest('./dest'));
</code></pre>

<h2 id="advanced-usage">Advanced usage</h2>

<p>If you want to configure postcss on per-file-basis, you can pass a callback
that receives <a href="https://github.com/gulpjs/vinyl">vinyl file object</a> and returns
<code>{ plugins: plugins, options: options }</code>. For example, when you need to
parse different extensions differntly:</p>

<pre><code class="js">var gulp = require('gulp');
var postcss = require('gulp-postcss');

gulp.task('css', function () {
    function callback(file) {
        return {
            plugins: [
                require('postcss-import')({ root: file.dirname }),
                require('postcss-modules')
            ],
            options: {
                parser: file.extname === '.sss' ? require('sugarss') : false
            }
        }
    }
    return gulp.src('./src/*.css')
        .pipe(postcss(callback))
        .pipe(gulp.dest('./dest'));
});
</code></pre>

<p>The same result may be achieved with
<a href="https://www.npmjs.com/package/postcss-load-config"><code>postcss-load-config</code></a>,
because it receives <code>ctx</code> with the context options and the vinyl file.</p>

<pre><code class="js">var gulp = require('gulp');
var postcss = require('gulp-postcss');

gulp.task('css', function () {
    var contextOptions = { modules: true };
    return gulp.src('./src/*.css')
        .pipe(postcss(contextOptions))
        .pipe(gulp.dest('./dest'));
});
</code></pre>

<pre><code class="js">module.exports = function (ctx) {
    var file = ctx.file;
    var options = ctx.options;
    return {
        parser: file.extname === '.sss' ? : 'sugarss' : false,
        plugins: {
           'postcss-import': { root: file.dirname }
           'postcss-modules': options.modules ? {} : false
        }
    }
})
</code></pre>

<h2 id="changelog">Changelog</h2>

<ul>
<li><p>9.0.1</p>

<ul>
<li>Bump postcss-load-config to ^3.0.0</li>
</ul></li>
<li><p>9.0.0</p>

<ul>
<li>Bump PostCSS to 8.0</li>
<li>Drop Node 6 support</li>
<li>PostCSS is now a peer dependency</li>
</ul></li>
<li><p>8.0.0</p>

<ul>
<li>Bump PostCSS to 7.0</li>
<li>Drop Node 4 support</li>
</ul></li>
<li><p>7.0.1</p>

<ul>
<li>Drop dependency on gulp-util</li>
</ul></li>
<li><p>7.0.0</p>

<ul>
<li>Bump PostCSS to 6.0</li>
<li>Smaller module size</li>
<li>Use eslint instead of jshint</li>
</ul></li>
<li><p>6.4.0</p>

<ul>
<li>Add more details to <code>PluginError</code> object</li>
</ul></li>
<li><p>6.3.0</p>

<ul>
<li>Integrated with postcss-load-config</li>
<li>Added a callback to configure postcss on per-file-basis</li>
<li>Dropped node 0.10 support</li>
</ul></li>
<li><p>6.2.0</p>

<ul>
<li>Fix syntax error message for PostCSS 5.2 compatibility</li>
</ul></li>
<li><p>6.1.1</p>

<ul>
<li>Fixed the error output</li>
</ul></li>
<li><p>6.1.0</p>

<ul>
<li>Support for <code>null</code> files</li>
<li>Updated dependencies</li>
</ul></li>
<li><p>6.0.1</p>

<ul>
<li>Added an example and a test to pass options to PostCSS (e.g. <code>syntax</code> option)</li>
<li>Updated vinyl-sourcemaps-apply to 0.2.0</li>
</ul></li>
<li><p>6.0.0</p>

<ul>
<li>Updated PostCSS to version 5.0.0</li>
</ul></li>
<li><p>5.1.10</p>

<ul>
<li>Use autoprefixer in README</li>
</ul></li>
<li><p>5.1.9</p>

<ul>
<li>Prevent unhandled exception of the following pipes from being suppressed by Promise</li>
</ul></li>
<li><p>5.1.8</p>

<ul>
<li>Prevent streamâ€™s unhandled exception from being suppressed by Promise</li>
</ul></li>
<li><p>5.1.7</p>

<ul>
<li>Updated direct dependencies</li>
</ul></li>
<li><p>5.1.6</p>

<ul>
<li>Updated <code>CssSyntaxError</code> check</li>
</ul></li>
<li><p>5.1.4</p>

<ul>
<li>Simplified error handling</li>
<li>Simplified postcss execution with object plugins</li>
</ul></li>
<li><p>5.1.3 Updated travis banner</p></li>
<li><p>5.1.2 Transferred repo into postcss org on github</p></li>
<li><p>5.1.1</p>

<ul>
<li>Allow override of <code>to</code> option</li>
</ul></li>
<li><p>5.1.0 PostCSS Runner Guidelines</p>

<ul>
<li>Set <code>from</code> and <code>to</code> processing options</li>
<li>Don't output js stack trace for <code>CssSyntaxError</code></li>
<li>Display <code>result.warnings()</code> content</li>
</ul></li>
<li><p>5.0.1</p>

<ul>
<li>Fix to support object plugins</li>
</ul></li>
<li><p>5.0.0</p>

<ul>
<li>Use async API</li>
</ul></li>
<li><p>4.0.3</p>

<ul>
<li>Fixed bug with relative source map</li>
</ul></li>
<li><p>4.0.2</p>

<ul>
<li>Made PostCSS a simple dependency, because peer dependency is deprecated</li>
</ul></li>
<li><p>4.0.1</p>

<ul>
<li>Made PostCSS 4.x a peer dependency</li>
</ul></li>
<li><p>4.0.0</p>

<ul>
<li>Updated PostCSS to 4.0</li>
</ul></li>
<li><p>3.0.0</p>

<ul>
<li>Updated PostCSS to 3.0 and fixed tests</li>
</ul></li>
<li><p>2.0.1</p>

<ul>
<li>Added Changelog</li>
<li>Added example for a custom processor in README</li>
</ul></li>
<li><p>2.0.0</p>

<ul>
<li>Disable source map by default</li>
<li>Test source map</li>
<li>Added Travis support</li>
<li>Use autoprefixer-core in README</li>
</ul></li>
<li><p>1.0.2</p>

<ul>
<li>Improved README</li>
</ul></li>
<li><p>1.0.1</p>

<ul>
<li>Don't add source map comment if used with gulp-sourcemaps</li>
</ul></li>
<li><p>1.0.0</p>

<ul>
<li>Initial release</li>
</ul></li>
</ul>
